<%= include ActionView::Helpers::AssetUrlHelper %>

export function runQuiz() {
  var score = 0;
  document.addEventListener('click', function (event) {
    if(event.target.classList.contains('button-question')) {
      event.preventDefault();
      var context = questionContext();
      score = score + parseInt(event.target.value);
      context.currentQuestion.classList.add('invisible');

      context.audio.addEventListener('ended', function() {
        if(context.nextQuestion != null) {
          context.nextQuestion.classList.remove('invisible');
        } else {
          var scoreEvent = new CustomEvent('calculateScore', { detail: score });
          document.dispatchEvent(scoreEvent);
          document.getElementById('submit-quiz').classList.remove('invisible');
          document.getElementById('final-dialog').classList.remove('invisible');
        }
      });
      context.audio.play();
    }
  });
}

function questionContext() {
  var visible;
  var questions = document.getElementsByClassName('question');
  var qIndex = 0;
  for(var i = 0; i < questions.length; i += 1) {
    if(!questions[i].classList.contains('invisible')) {
      visible = questions[i];
      qIndex = i;
    }
  }
  var audio = visible.querySelector('audio')
  return { audio: audio, currentQuestion: visible, nextQuestion: questions[qIndex + 1] };
}

function questionScore(question) {
  var points = 0;
  var answers = question.getElementsByClassName('radio-question');
  if(answers[0].checked) { points = 1; }
  if(answers[1].checked) { points = 2; }
  if(answers[2].checked) { points = 3;; }
  return points;
}

export function titleScreen(wm)
{
  const test = wm.createWindow({
    width: 1200,
    height: 800,
    x: 100, y: 100,
    titlebar: false,
    maximizable: false,
    minimizable: false,
    resizable: false,
    closable: false,
    movable: false
  })
  test.content.style.padding = '0.5em'
  test.content.backgroundColor = 'black'
  test.content.color = 'white'
  test.content.innerHTML = `
  <div class="centered mt-9000">
    <h1 class="play-title">(I Know You're Having Fun But)</h1>
    <h1 class="work-title">I'm Still Working</h1>
  </div>
  <div class="centered title-text">
    <p class="mb-2">We all have too much fun at work from time to time. In this game you’ll contribute to actual real life important ecology data while dealing with a workplace that likes to have just a little too much fun.</p>
    <p class="mb-2">If you’d like to contribute to actual real life important ecology data without the fun visit <a href="https://instantwild.zsl.org">instantwild.zsl.org</a></p>
    <button id="start-game" class="sbtn mt-5">Start Game</button>
  </div>
  `
  test.win.addEventListener('test', function() { alert('wow'); });
  return test
}

export function quiz(wm)
{
  const test = wm.createWindow({
    width: 1200,
    height: 800,
    x: 100, y: 100,
    titlebar: false,
    maximizable: false,
    minimizable: false,
    resizable: false,
    closable: false,
    movable: false
  })
  test.content.style.padding = '0.5em'
  test.content.innerHTML = `
    <audio id="audio-introduction"  src="<%= audio_path('clip1.mp3') %>" type="audio/mp3"></audio>
    <form id="quiz">
      <fieldset id="group1" class="centered question">
        <p class="dialog"><i>
        “Hey bud! Looks like you’re the only one who made it back from orientation! Ha! We like to have fun around here! Ahhhhhh but no seriously, we do very important work here at GlobalEarth. Before we get you started on the database we want to see how you’re going to fit in around here.”
        </i></p>
        <p class="mb-5 question-text">I lose interest quickly if I don't get to learn new things.</p>
        <button class="button-question sbtn mr-3" value=1 name="group1">Always</button>
        <button class="button-question sbtn mr-3" value=2 name="group1">Sometimes</button>
        <button class="button-question sbtn" value=3 name="group1">Never</button>
        <audio src="<%= audio_path('clip2.mp3') %>" type="audio/mp3"></audio>
      </fieldset>

      <fieldset id="group2" class="centered question invisible">
        <p class="dialog"><i>
        “Two hundred and fifty slides on parking policies and pensions. HR loses as many people as they hire! ”
        </i></p>
        <p class="mb-5 question-text">I believe stories are the best way to get a point across.</p>
        <button class="button-question sbtn mr-3" value=1 name="group1">Always</button>
        <button class="button-question sbtn mr-3" value=2 name="group1">Sometimes</button>
        <button class="button-question sbtn" value=3 name="group1">Never</button>
        <audio src="<%= audio_path('clip3.mp3') %>" type="audio/mp3"></audio>
      </fieldset>

      <fieldset id="group3" class="centered question invisible">
        <p class="dialog"><i>
        “Oh boy we love to tell stories around here! Dave in HR was telling me about a growth on his… Well let me just say that I'd have to speak with Dave in HR if I told you”
        </i></p>
        <p class="mb-5 question-text">I need to take control of situations that seem to be out of control.</p>
        <button class="button-question sbtn mr-3" value=1 name="group1">Always</button>
        <button class="button-question sbtn mr-3" value=2 name="group1">Sometimes</button>
        <button class="button-question sbtn" value=3 name="group1">Never</button>
        <audio src="<%= audio_path('clip4.mp3') %>" type="audio/mp3"></audio>
      </fieldset>

      <fieldset id="group4" class="centered question invisible">
        <p class="dialog"><i>
        “You know who’s out of control!? That Dave in HR! But you saw the orientation Power Point, you know”
        </i></p>
        <p class="mb-5 question-text">I believe that even the most disadvantageous peace is better than any direct conflict.</p>
        <button class="button-question sbtn mr-3" value=1 name="group1">Always</button>
        <button class="button-question sbtn mr-3" value=2 name="group1">Sometimes</button>
        <button class="button-question sbtn" value=3 name="group1">Never</button>
        <audio src="<%= audio_path('clip5.mp3') %>" type="audio/mp3"></audio>
      </fieldset>

      <fieldset id="group5" class="centered question invisible">
        <p class="dialog"><i>
        “A girl in college told me I have a disadvantageous peace HEY OH!!!”
        </i></p>
        <p class="mb-5 question-text">I find it difficult to incorporate new ideas with my existing world view.</p>
        <button class="button-question sbtn mr-3" value=1 name="group1">Always</button>
        <button class="button-question sbtn mr-3" value=2 name="group1">Sometimes</button>
        <button class="button-question sbtn" value=3 name="group1">Never</button>
        <audio src="<%= audio_path('clip6.mp3') %>" type="audio/mp3"></audio>
      </fieldset>
  </form>
  <div class="centered">
    <p class="dialog invisible" id="final-dialog"><i>
    “OK BOOMER! (Laughs uncontrollably) Dave says we can’t say it in interviews anymore but you’re already hired! (More loud obnoxious laughter)”

<br/>
    Knock on the door

<br/>
    (Outside voice)
  “I know you’re having fun, but I’m still working”

<br/>
</i></p>
    <button class="invisible sbtn start-working" id="submit-quiz">Start Working</button>
  </div>
`
  return test
}
